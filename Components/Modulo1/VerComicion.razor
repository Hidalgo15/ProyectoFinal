@page "/Agente/Comision"
@using Microsoft.EntityFrameworkCore
@layout LayoutMod3
@inject ContextoDige Cd
@inject NavigationManager NavMan



<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="/Agente">Agente</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item">
                    <a class="nav-link" href="/Agente/Mapa">Mapas de multas</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/Agente/Comision">Comision</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/Login">Cerrar sesi칩n</a>
                </li>
                
            </ul>
        </div>
    </div>
</nav>

<div class="header-box mx-auto mt-5 p-3">
    <h2 class="text-center">COMISION POR MES 游눯</h2>
</div>

<style>
    .header-box {
        background-color: rgba(255, 255, 255, 0.9); /* Blanco semitransparente */
        border-radius: 8px; /* Bordes redondeados */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra suave */
        max-width: 600px; /* Ancho m치ximo */
    }

    h2 {
        color: #000; /* Color del texto */
        margin: 0;
    }
</style>


<div class="info-box p-3 mt-3">
    <p><strong>Total de Ingresos:</strong> @totalComision</p>
</div>

<style>
    .info-box {
        background-color: #fff; /* Fondo blanco */
        border-radius: 8px; /* Bordes redondeados */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra suave */
        padding: 15px; /* Espaciado interno */
        max-width: 400px; /* Ancho m치ximo del cuadro */
        margin: auto; /* Centrado en la p치gina */
        border: 1px solid #ddd; /* Borde gris claro */
    }

    .info-box p {
        margin: 0;
        font-size: 1.1rem; /* Tama침o de fuente */
        color: #333; /* Color del texto */
    }

    .info-box strong {
        color: #000; /* Color del texto en negrita */
    }
</style>


<div class="header-box ms-3 mt-5 p-3">
    <h2>칔ltimos 5 Aportes (칔ltimas 5 Multas):</h2>
</div>

<style>
    .header-box {
        background-color: rgba(255, 255, 255, 0.9); /* Blanco semitransparente */
        border-radius: 8px; /* Bordes redondeados */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Sombra suave */
        max-width: 600px; /* Ancho m치ximo */
        margin-left: 0; /* Asegura que no est칠 centrado */
    }

    h2 {
        color: #000; /* Color del texto */
        margin: 0;
        text-align: left; /* Alineaci칩n a la izquierda */
    }
</style>


<table class="table">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Comisi칩n</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var multa in ultimasMultas)
        {
            <tr>
                <td>@multa.Fecha.ToString("dd/MM/yyyy")</td>
                <td>@(multa.Concepto?.Monto * 0.10m)</td>  <!-- Calculamos el 10% de la multa -->
            </tr>
        }
    </tbody>
</table>

@code {
    private decimal totalComision = 0;
    private List<Multa> ultimasMultas = new List<Multa>();

    protected override async Task OnInitializedAsync()
    {
        // Obtener el usuario actual de la sesi칩n
        var usuarioActual = UsuarioSession.GetInstance().UsuarioActual;

        if (usuarioActual == null)
        {
            // Redirigir al login si no hay usuario en sesi칩n
            NavMan.NavigateTo("/Login");
            return;
        }

        // Cargar las 칰ltimas 5 multas del agente en sesi칩n, incluyendo el concepto relacionado
        ultimasMultas = await Cd.Multas
            .Where(m => m.CedulaUsuario == usuarioActual.Cedula && m.Estado == Estado.Cobrado)  // Filtrar por las multas cobradas
            .OrderByDescending(m => m.Fecha)  // Ordenar por fecha descendente
            .Take(5)  // Obtener las 칰ltimas 5
            .Include(m => m.Concepto)  // Incluir el concepto relacionado para obtener el monto
            .ToListAsync();

        // Calcular la comisi칩n total (10% de cada multa)
        totalComision = ultimasMultas.Sum(m => m.Concepto?.Monto * 0.10m ?? 0);
    }

    private void VerComision()
    {
        // Aqu칤 podr칤as redirigir a una p치gina con detalles m치s espec칤ficos, si lo deseas.
        NavMan.NavigateTo("/Agente/DetalleComision");
    }
}

<style>
    /* Fondo de la p치gina */
body {
    background: url('https://presidencia.gob.do/sites/default/files/styles/large/public/news/2024-03/IMG_3300.jpg?itok=FWknYs5_') no-repeat center center;
    background-size: cover;
    color: #fff; /* Texto blanco para contraste */
}

/* Contenedor principal */
.container {
    background-color: rgba(255, 255, 255, 0.9); /* Fondo semitransparente */
    border-radius: 10px;
    padding: 20px;
}

/* T칤tulo principal */
h2 {
    color: #00549d;
    text-align: center;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7); /* Sombra para mayor contraste */
}

/* Subt칤tulo */
h3 {
    color: #000000;
}

/* Botones */
.btn-primary {
    background-color: #00549d;
    border: none;
    color: #fff;
    padding: 10px 20px;
    border-radius: 5px;
}

.btn-primary:hover {
    background-color: #003f7d;
}

.btn-secondary {
    background-color: #000000;
    color: #fff;
}

.btn-secondary:hover {
    background-color: #000000;
}

/* Tabla */
table {
    width: 100%;
    margin-top: 30px;
    border-collapse: collapse;
    background-color: rgba(255, 255, 255, 0.9); /* Fondo semitransparente */
}

table th {
    background-color: #00549d;
    color: #000000;
}

table td {
    color: #000000;
}

table tbody tr:nth-child(even) {
    background-color: #ffffff;
}

table tbody tr:hover {
    background-color: #ffffff;
}

/* Estilos para las im치genes de la tabla */
table img {
    border-radius: 5px;
}

/* Estilos del navbar */
.navbar {
    background-color: rgba(255, 255, 255, 0.8); /* Fondo semitransparente para navbar */
}

.navbar-brand {
    color: #00549d;
}

.navbar-nav .nav-link {
    color: #00549d;
}

.navbar-nav .nav-link:hover {
    color: #003f7d;
}

/* Estilo de la fila en la tabla con la comisi칩n */
table td:nth-child(2) {
    color: #28a745; /* Verde para las comisiones */
    font-weight: bold;
}

/* Estilos del contenedor del bot칩n */
.text-end {
    margin-top: 30px;
}

/* Estilo para el p치rrafo de total de ingresos */
p {
    font-size: 1.2em;
    color: #28a745; /* Verde para el total de ingresos */
    font-weight: bold;
    margin-top: 20px;
}

/* Modal */
.modal-content {
    background-color: rgba(255, 255, 255, 0.9); /* Fondo semitransparente para modal */
    border-radius: 10px;
}

/* Estilos de los botones del modal */
.modal-footer .btn-secondary {
    background-color: #000000;
}

.modal-footer .btn-danger {
    background-color: #dc3545;
}

.modal-footer .btn-secondary:hover {
    background-color: #000000;
}

.modal-footer .btn-danger:hover {
    background-color: #c82333;
}

</style>
